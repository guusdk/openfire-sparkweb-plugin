<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE xep SYSTEM 'xep.dtd' [
  <!ENTITY % ents SYSTEM 'xep.ent'>
  %ents;
  ]>
<?xml-stylesheet type='text/xsl' href='xep.xsl'?>
<xep xmlns="">
<header>
  <title>HTTP Online Meetings</title>
  <abstract>This specification defines a protocol extension to request URLs from an external HTTP entity usable to create and invite participants to an online meeting.</abstract>
  <legal>
    <copyright>This XMPP Extension Protocol is copyright © 1999 – 2023 by the <link url="https://xmpp.org/">XMPP Standards Foundation</link> (XSF).</copyright>
    <permissions>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</permissions>
    <warranty>## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</warranty>
    <liability>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</liability>
    <conformance>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<link url="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</link>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</conformance>
  </legal>
  <number>XXXX</number>
  <status>ProtoXEP</status>
  <type>Standards Track</type>
  <sig>Standards</sig>
  <approver>Council</approver>
  <dependencies>
    <spec>XEP-0066</spec>
  </dependencies>
  <supersedes/>
  <supersededby/>
  <shortname>http_online-meetings</shortname>
  <author>
    <firstname>Dele</firstname>
    <surname>Olajide</surname>
    <email>dele@olajide.net</email>
    <jid>dele.olajide@igniterealtime.org</jid>
  </author>
  <author>
    <firstname>Guus</firstname>
    <surname>der Kinderen</surname>
    <email>guus.der.kinderen@gmail.com</email>
    <jid>guus.der.kinderen@igniterealtime.org</jid>
  </author>
  <revision>
    <version>0.0.3</version>
    <date>2023-09-12</date>
    <initials>gdk</initials>
    <remark>
      <ul>
        <li>Modified wording of abstract.</li>
        <li>Specified distribution of URL / add meeting invitation</li>
        <li>Differentiate between Meeting service providers that are integrated with XMPP server, and those that are not.</li>
        <li>Differentiate between URL to create and join meeting</li>
        <li>Replaced textual references with XML entities</li>
        <li>Introduced distinct namespaces for create and invite, retaining type-specific namespaces for feature discovery</li>
        <li>Introcuced Meeting Service type registry</li>
        <li>Removed CORS-related implementation note</li>
      </ul>
    </remark>
  </revision>
  <revision>
    <version>0.0.2</version>
    <date>2023-08-22</date>
    <initials>do</initials>
    <remark>
      <ul>
        <li>Remove base URL attribute.</li>
        <li>Add support for a web-based protocol handler in OOB data result.</li>
      </ul>
    </remark>
  </revision>
  <revision>
    <version>0.0.1</version>
    <date>2023-08-21</date>
    <initials>do</initials>
    <remark>
      <ul>
        <li>Initial version.</li>
      </ul>
    </remark>
  </revision>
</header>
<section1 topic="Introduction" anchor="intro">
  <p>XMPP protocol extensions already defines a method for initiating peer-to-peer media sessions such as &xep0166; however due to its very nature of being peer-to-peer it does not work very well in scenarios with online meetings. It also does not work alongside offline storage, MUC history and &xep0313;.</p>
  <p>Using a web browser to manually request a URL from an HTTP server and sharing the link has been a workaround for this for a long time now. While users have a variety of services to choose from, the downside of this manual approach is that an XMPP client can not automate this process on behalf of the user since these services don’t share a common API.</p>
  <p>This XEP defines an approach to request creation of an online meeting via an HTTP server and receive a URL can be used to join and invite others to the meeting.</p>
</section1>
<section1 topic="Requirements" anchor="reqs">
  <ul>
    <li>Be as easy to implement as possible. This is grounded on the idea that most programming languages already have HTTP libraries available.</li>
    <li>Usable with Meeting service providers that have no XMPP integration.</li>
    <li>Anyone who knows the URL SHOULD be able to access it.</li>
  </ul>
</section1>
<section1 topic="Discovering Support" anchor="disco">
  <section2 topic="Creation of Meetings" anchor="disco-creation">
    <p>An entity advertises support for meeting initiation, as specified by this protocol, by including the "urn:xmpp:http:online-meetings:create" namespace, as well as "urn:xmpp:http:online-meetings:xxxxxx:0" (where xxxxx is the name of the supported meeting service) namespaces in its service discovery information features as specified in &xep0030; or section 6.3 of &xep0115;.</p>
    <p>A user’s server SHOULD include itself as a services provider for this protocol in its service discovery items.</p>
    <example caption="Client sends service discovery request to server"><![CDATA[
<iq from='romeo@montague.tld/garden'
    id='step_01'
    to='montague.tld' type='get'>
  <query xmlns='http://jabber.org/protocol/disco#info'/>
</iq>]]></example>
    <example caption="Server replies to service discovery request and reports capability to create online meeting for Jitsi and Galene"><![CDATA[
<iq from='montague.tld'
    id='step_01'
    to='romeo@montague.tld/garden'
    type='result'>
  <query xmlns='http://jabber.org/protocol/disco#info'>
    <identity category='server' type='im' name='Openfire Server' />
    <feature var='urn:xmpp:http:online-meetings:create:0' />
    <feature var='urn:xmpp:http:online-meetings:jitsi:0' />
    <feature var='urn:xmpp:http:online-meetings:galene:0' />
  </query>
</iq>]]></example>
  </section2>
  <section2 topic="Invitation" anchor="disco-server">
    <p>If an entity supports receiving meeting invitations as specified by this protocol, it advertises support by including the "urn:xmpp:http:online-meetings:invite:0" in its service discovery information features as specified in &xep0030; or section 6.3 of &xep0115;.</p>
    <example caption="Client sends service discovery request to invitee"><![CDATA[
<iq from='romeo@montague.tld/garden'
    id='invite_01'
    to='juliet@capulet.example/balcony' type='get'>
  <query xmlns='http://jabber.org/protocol/disco#info'/>
</iq>]]></example>
    <example caption="Server replies to service discovery request and reports capability to create online meeting for Jitsi and Galene"><![CDATA[
<iq from='juliet@capulet.example/balcony'
    id='invite_01'
    to='romeo@montague.tld/garden'
    type='result'>
  <query xmlns='http://jabber.org/protocol/disco#info'>
    <identity category='client' type='im' name='Spark' />
    <feature var='urn:xmpp:http:online-meetings:invite:0' />
  </query>
</iq>]]></example>
    <p>In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined in &xep0115;. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.</p>
  </section2>
</section1>
<section1 topic="Requesting a Meeting" anchor="request">
  <p>A client requests an online new meeting URL by sending an IQ-get to the server containing a &lt;request&gt; child element qualified by the 'urn:xmpp:http:online-meetings:invite:0' namespace. This element MUST include the type attribute specifying the Meeting Service type, which SHOULD be registered as described in the <link url="#registrar-type">Meeting Service Type Registry</link> section of this document and MUST include the id attribute specifying the identity of the online meeting requested.</p>
  <example caption="Client requests an online meeting URL from the server"><![CDATA[
<iq from='romeo@montague.tld/garden' 
    id='step_02' 
    to='montague.tld' 
    type='get'>
  <request xmlns='urn:xmpp:http:online-meetings:create:0'
           type='jitsi' id='my-meeting' />
</iq>]]></example>
  <p>The XMPP server responds with one or two &xep0066; elements, one that contains a URL to be used to create and configure the meeting, and one that contains a URL suitable to invite others into the meeting.</p>
  <p>In the URLs that it returns, the server MAY specify a web-based protocol handler if available and registered by the user. Otherwise, standard HTTPS protocol will be specified. In any case, the fully resolved URL provided by the host MUST provide Transport Layer Security (&rfc5246;). The HTTPS URL MUST adhere to &rfc3986;. Non ASCII characters MUST be percent-encoded.</p>
  <example caption="The server responds with an out of band URI specifying the jitsi web-based protocol handler"><![CDATA[
<iq from='montague.tld' 
    id='step_03' 
    to='romeo@montague.tld/garden' 
    type='result'>
  <create xmlns='urn:xmpp:http:online-meetings:create:0' type='jitsi'>
    <x xmlns='jabber:x:oob'>
      <url>web+jitsi:https://meet.jit.si/my-meeting-4ba911a9ab321f2d2acd4e67118d5d</url>
      <desc>My Online Meeting</desc>
    </x>
  </create>
  <invite xmlns='urn:xmpp:http:online-meetings:create:0' type='jitsi'>
    <x xmlns='jabber:x:oob'>
      <url>web+jitsi:https://meet.jit.si/my-meeting-4ba911a9ab321f2d2acd4e67118d5d</url>
      <desc>My Online Meeting</desc>
    </x>
  </invite>
</iq>]]></example>
  <example caption="The server responds with an out of band URI using standard HTTPS"><![CDATA[
<iq from='montague.tld' 
    id='step_03' 
    to='romeo@montague.tld/garden' 
    type='result'>
  <create xmlns='urn:xmpp:http:online-meetings:create:0' type='jitsi'>
    <x xmlns='jabber:x:oob'>
      <url>https://meet.jit.si/my-meeting-4ba911a9ab321f2d2acd4e67118d5d</url>
      <desc>My Online Meeting</desc>
    </x>
  </create>
  <invite xmlns='urn:xmpp:http:online-meetings:create:0' type='jitsi'>
    <x xmlns='jabber:x:oob'>
      <url>https://meet.jit.si/my-meeting-4ba911a9ab321f2d2acd4e67118d5d</url>
      <desc>My Online Meeting</desc>
    </x>
  </invite>
</iq>]]></example>
  <p>The XMPP server MAY be tightly integrated with the Meeting Provider and facilitate registration, configuration and association of a web-based protocol handler, but the protocol to implement such integration is out of scope of this document.</p>
  <p>If the XMPP server is tightly integrated with the Meeting Provider, and no other data is needed for a meeting to be created, the XMPP server MAY create a meeting on behalf of the requester and leave out the 'create' element from the response. Note that a server SHOULD include a 'create' URL in its response if it cannot create a meeting on behalf of the requesting entity, even if it knows that no additional data is needed for a meeting to be automatically created upon joining the meeting URL. Inclusion of the 'create' element signals that the requesting entity may need join the meeting as the first participant, in order to be assigned 'creator' or 'moderator' privileges.</p>
</section1>
<section1 topic="Error conditions" anchor="errors">
  <p>Instead of providing the client with a URL the server MAY respond with an error if the request fails. In addition, the HTTP entity MAY inform the requester about the reason for the failure.</p>
  <example caption="Alternative response by the server if the meeting request includes unsupported type"><![CDATA[
<iq from='montague.tld'
    id='step_03'
    to='romeo@montague.tld/garden'
    type='error'>
  <request xmlns='urn:xmpp:http:online-meetings:create:0'
           type='jitsi' id='my-meeting' />
  <error type='cancel'>
    <service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas' />
    <text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'>The 'jitsi' meeting service provider type is not supported.</text>
  </error>
</iq>]]></example>
  <example caption="Alternative response by the server if the meeting request fails due to meeting ID collision"><![CDATA[
<iq from='montague.tld' 
    id='step_03' 
    to='romeo@montague.tld/garden' 
    type='error'>
  <request xmlns='urn:xmpp:http:online-meetings:create:0'
           type='jitsi' id='my-meeting' />
  <error type='modify'>
    <not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas' />
    <text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'>Meeting is in use</text>
  </error>
</iq>]]></example>
  <p>For any other type of error the service SHOULD respond with appropriate error types to indicate temporary or permanent errors.</p>
  <p>For temporary errors such as exceeding a personal quota the service MAY include a &lt;retry/&gt; element qualified by the 'urn:xmpp:http:online-meetings:create:0' namespace as a child of the &lt;error/&gt; element. The retry element MUST include an attribute 'stamp' which indicates the time at which the requesting entity may try again. The format of the timestamp MUST adhere to the date-time format specified in &xep0082; and MUST be expressed in UTC.</p>
  <example caption="Alternative response by the server to indicate a temporary error after the client exceeded a quota"><![CDATA[
<iq from='montague.tld' 
    id='step_03' 
    to='romeo@montague.tld/garden' 
    type='error'>
  <request xmlns='urn:xmpp:http:online-meetings:create:0'
           type='jitsi' id='my-meeting' />
  <error type='wait'>
    <resource-constraint xmlns='urn:ietf:params:xml:ns:xmpp-stanzas' />
    <text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'>Quota reached. You can only request 5 meetings a day</text>
    <retry xmlns='urn:xmpp:http:online-meetings:create:0' stamp='2017-12-03T23:42:05Z' />
  </error>
</iq>]]></example>
  <example caption="Alternative response by the server to indicate an auth error to a client that is not allowed to create an online meeting"><![CDATA[
<iq from='montague.tld' id='step_03' 
    to='romeo@montague.tld/garden' 
    type='error'>
  <request xmlns='urn:xmpp:http:online-meetings:create:0'
           type='jitsi' id='my-meeting' />
  <error type='auth'>
    <forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas' />
    <text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'>Only premium members are allowed to create meetings</text>
  </error>
</iq>]]></example>
</section1>
<section1 topic="Meeting Invitation" anchor="meeting-invitation">
  <p>After the requesting entity has successfully created a meeting, it MAY invite other entities to join the meeting. It does so by sending invitees a message stanza containing the invite URL received from the server.</p>
  <example caption="User sends meeting invitation"><![CDATA[
<message from='romeo@montague.tld/garden'
    to='juliet@capulet.example/balcony'>
  <invite xmlns='urn:xmpp:http:online-meetings:create:0' type='jitsi'>
    <x xmlns='jabber:x:oob'>
      <url>https://meet.jit.si/my-meeting-4ba911a9ab321f2d2acd4e67118d5d</url>
      <desc>My Online Meeting</desc>
    </x>
  </invite>
</message>]]></example>
  <p>There is no further XMPP communication required between the server and the client for the client to join the meeting. The actual online meeting engagement with the provided URL is out of scope of this document.</p>
</section1>
<section1 topic="Implementation Notes" anchor="impl">
  <p>The server SHOULD choose an appropriate timeout for the validity of the URL. Since there is no reason for a client to wait between requesting the URL and joining the meeting via the URL before dispatching invitations, relatively low timeout values of around 300s are RECOMMENDED.</p>
</section1>
<section1 topic="Security Considerations" anchor="security">
  <section2 topic="General" anchor="general">
    <ul>
      <li>Service implementors SHOULD use long randomized parts in their URLs making it impossible to guess the location of arbitrary meeting url.</li>
      <li>Implementors should keep in mind, that without additional end-to-end-encryption, online meetings may not be secure. Client implementors are advised to either use this only for semi public meetings (for example meetings hosted on a public MUC) or implement appropriate end-to-end encryption.</li>
      <li>Joining an HTTP Online Meeting will leak the client’s IP address to the HTTP service. The HTTP service might not be the same service as the XMPP service the client is currently connected to.</li>
  </ul>
  </section2>
</section1>
<section1 topic="IANA Considerations" anchor="iana">
  <p>This document requires no interaction with the &IANA;</p>
</section1>
<section1 topic="XMPP Registrar Considerations" anchor="registrar">
  <section2 topic="Protocol Namespaces" anchor="registrar-ns">
    <p>This specification defines the following XML namespaces:</p>
    <ul>
      <li>urn:xmpp:http:online-meetings:create:0</li>
      <li>urn:xmpp:http:online-meetings:invite:0</li>
      <li>urn:xmpp:http:online-meetings:jitsi:0</li>
      <li>urn:xmpp:http:online-meetings:galene:0</li>
    </ul>
    <p>Upon advancement of this specification from a status of Experimental to a status of Draft, the &REGISTRAR; shall add the foregoing namespace to the registry located at &NAMESPACES;, as described in Section 4 of &xep0053;.</p>
  </section2>
  <section2 topic="Meeting Serviced Type Registry" anchor="registrar-type">
    <p>The XMPP Registrar maintains a registry of Meeting provider types at TBD.</p>
  </section2>
</section1>
<section1 topic="XML Schema" anchor="schema">
  <code><![CDATA[
<xml version="1.0" encoding="utf8">
<!-- TBD -->
]]></code>
</section1>
</xep>
